{% extends 'base.html' %}

{% block title %}Checkout - Farmacias La Guadalajara{% endblock %}
{% block header_title %}Finalizar Compra{% endblock %}
{% block header_subtitle %}Confirma tu pedido{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-light">
                <h5 class="mb-0">Información de Contacto y Envío</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    <!-- Información de contacto -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2">Información de Contacto</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nombre" class="form-label">Nombre completo *</label>
                                <input type="text" class="form-control" id="nombre" name="nombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Correo electrónico *</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       value="{{ session.get('user_email', '') }}" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="telefono" class="form-label">Teléfono *</label>
                                <input type="tel" class="form-control" id="telefono" name="telefono" required>
                            </div>
                        </div>
                    </div>

                    <!-- Dirección de envío -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2">Dirección de Envío</h6>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="address" class="form-label">Dirección completa *</label>
                                <input type="text" class="form-control" id="address" name="address" 
                                       placeholder="Calle, número, colonia, código postal" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="ciudad" class="form-label">Ciudad *</label>
                                <input type="text" class="form-control" id="ciudad" name="ciudad" value="Guadalajara" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="estado" class="form-label">Estado *</label>
                                <input type="text" class="form-control" id="estado" name="estado" value="Jalisco" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cp" class="form-label">Código Postal *</label>
                                <input type="text" class="form-control" id="cp" name="cp" required>
                            </div>
                        </div>
                    </div>

                    <!-- Método de pago -->
                    <div class="mb-4">
                        <h6 class="border-bottom pb-2">Método de Pago</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="metodo_pago" id="efectivo" checked>
                            <label class="form-check-label" for="efectivo">
                                <i class="bi bi-cash-coin me-2"></i>Pago en efectivo al recibir
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="metodo_pago" id="tarjeta">
                            <label class="form-check-label" for="tarjeta">
                                <i class="bi bi-credit-card me-2"></i>Tarjeta de crédito/débito
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="metodo_pago" id="transferencia">
                            <label class="form-check-label" for="transferencia">
                                <i class="bi bi-bank me-2"></i>Transferencia bancaria
                            </label>
                        </div>
                    </div>

                    <!-- Notas adicionales -->
                    <div class="mb-4">
                        <label for="notas" class="form-label">Notas adicionales para la entrega</label>
                        <textarea class="form-control" id="notas" name="notas" rows="3" 
                                  placeholder="Instrucciones especiales para la entrega..."></textarea>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle me-2"></i>Confirmar Pedido
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Resumen del pedido -->
        <div class="card sticky-top" style="top: 100px;">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Resumen del Pedido</h5>
            </div>
            <div class="card-body">
                {% if session.get('cart') %}
                    {% set cart = session.get('cart', {}) %}
                    {% set total = 0 %}
                    
                    {% for pid, qty in cart.items() %}
                        {% set prod = products | selectattr("_id", "equalto", pid) | first %}
                        {% if prod %}
                            {% set subtotal = prod.price * qty %}
                            {% set total = total + subtotal %}
                            <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                                <div>
                                    <small class="fw-semibold">{{ prod.name }}</small>
                                    <br>
                                    <small class="text-muted">{{ qty }} x ${{ "%.2f"|format(prod.price) }}</small>
                                </div>
                                <small class="fw-semibold">${{ "%.2f"|format(subtotal) }}</small>
                            </div>
                        {% endif %}
                    {% endfor %}
                    
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>${{ "%.2f"|format(total) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Envío:</span>
                            <span class="text-success">Gratis</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Total:</strong>
                            <strong class="h5 text-primary">${{ "%.2f"|format(total) }}</strong>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Información de contacto rápida -->
        <div class="card mt-4">
            <div class="card-body">
                <h6 class="card-title">
                    <i class="bi bi-telephone text-primary me-2"></i>¿Necesitas ayuda?
                </h6>
                <p class="small text-muted mb-2">
                    Llámanos al <strong>33 1234 5678</strong> para asistencia con tu pedido.
                </p>
                <p class="small text-muted mb-0">
                    Horario de atención: Lunes a Domingo, 8:00 AM - 10:00 PM
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}